<!DOCTYPE html>
<html>
<head>
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.3,user-scalable=no">
    <meta charset="utf-8">
    <title>👴</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <title>10点半下班作品???</title>
    <link rel="shortcut icon" type="image/x-icon" id="links"/>
    <script>
        var _hmt = _hmt || [];

        var num = Math.ceil(Math.random() * 10);
        document.getElementById("links").href = "res/image/ico/" + num + ".ico";
        // 判断是否为移动端运行环境
        if (/iPhone|iPod|Android/i.test(navigator.userAgent)) {
            setActiveStyleSheet("res/css/index_mobile.css");
        } else {
            setActiveStyleSheet("res/css/index_pc.css");
        }

        // 判断完毕后加载样式
        function setActiveStyleSheet(filename) {
            document.write("<link href=" + filename + " rel=stylesheet>");
        }
    </script>
    <style>
        .img-box img{
            position:absolute;
            top:0;
            bottom:0;
            left:0;
            right:0;
            width:100%;
            margin:auto;
            z-index: -1;
            *zoom:1;
            height:5811px;
        }

    </style>
</head>

    <script>
        const screenW = document.documentElement.clientWidth;
        const screenH = document.documentElement.clientHeight;
        const IS_PC = screenW > screenH

        // 获取域名
        host = window.location.host;
        httpHead = window.location.href.includes("https") ? "https://" : "http://"
        curUrl = host.includes("localhost") ?
            "localhost:8080/bili/getUpInfoList" :
            "goodgoodlaugh.com/8080/bili/getUpInfoList"
        urlWithParam = httpHead + curUrl + "?upId=31536760"
        console.log(urlWithParam)
        const segs = [];


        $(document).ready(function () {
            $.ajax({
                url: urlWithParam, success: function (result) {
                    // console.log(result)
                    var upVoList = result["upVoList"];
                    $("#div1").html(result.toString());
                    const arraySize = upVoList.length;
                    if (arraySize === 0) {
                        return;
                    }
                    //添加标签 1.第一步首先获得在那个标签下添加标签
                    console.log("for: " + arraySize);

                    for (let i = 0; i < arraySize; i++) {
                        const biliUpVo = upVoList[i];
                        // console.log("bili/getUpInfoList: " + biliUpVo.toString() + " GGG");
                        const biliRecordVoList = biliUpVo["biliRecordVoList"];
                        if (biliRecordVoList == null) {
                            continue;
                        }
                        const recordListSize = biliRecordVoList.length;
                        const labels = [];
                        const data = [];
                        const followerCountData = [];
                        const likeCountData = [];

                        let followerCountMax = 0;
                        let followerCountMin = 9999999999;

                        let likeCountMax = 0;
                        let likeCountMin = 9999999999;

                        for (let j = 0; j < recordListSize; j++) {
                            const biliRecordVo = biliRecordVoList[j];
                            labels[j] = moment(biliRecordVo["createTime"]).format("YYYY-MM-DD")
                            followerCountData[j] = getNaWhen0_1(biliRecordVo["followerCount"])
                            if (followerCountData[j] !== "N/A") {
                                followerCountMax = Math.max(followerCountData[j], followerCountMax)
                                followerCountMin = Math.min(followerCountData[j], followerCountMin)
                            }

                            likeCountData[j] = getNaWhen0_1(biliRecordVo["likeCount"])
                            if (likeCountData[j] !== "N/A") {
                                likeCountMax = Math.max(likeCountData[j], likeCountMax)
                                likeCountMin = Math.min(likeCountData[j], likeCountMin)
                            }

                        }
                        data[0] = followerCountData
                        data[1] = likeCountData
                        data["confg.followerCount.step"] = getNumWay((followerCountMax - followerCountMin) / 11)
                        data["confg.likeCount.step"] = getNumWay((likeCountMax - likeCountMin) / 11)
                        addCanvasHtml(biliUpVo["upId"], biliUpVo["upName"], labels, data)
                    }
                }
            });
        });

        /**
         * 根据 num 返回 Y 轴步长
         */
        function getNumWay(num) {
            if (num < 100) {
                return 10;
            }
            if (num < 1000) {
                return 100;
            }
            if (num < 10000) {
                return 1000;
            }
            if (num < 100000) {
                return 10000;
            }
            if (num < 1000000) {
                return 100000;
            }
            if (num < 10000000) {
                return 1000000;
            }
            if (num < 100000000) {
                return 10000000;
            }
            return 100000000;
        }

        /**
         * 非法数字返回 N/A
         * @param num
         * @returns {string|*}
         */
        function getNaWhen0_1(num) {
            if (num == null || num === 0 || num === "0" || num === -1 || num === "-1") {
                return "N/A";
            }
            return num
        }

        /**
         * 生成图表
         * @param chartId
         * @param chartName
         * @param labels
         * @param data
         */
        function addCanvasHtml(chartId, chartName, labels, data) {
            const canvasHtml = document.createElement("canvas");
            canvasHtml.id = chartId;
            canvasHtml.style.cssText = "height:666px;max-height:666px"

            const aChart = document.createElement("a");
            aChart.id = "seg-begin" + chartId;
            aChart.className = "seg-begin"


            const charts = document.getElementById("charts");
            charts.appendChild(aChart)
            charts.appendChild(canvasHtml)

            // 颜色 最后一位是深浅
            const color = [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(63,143,245,0.9)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ];
            Chart.defaults.font.size = 18;
            const myChart = new Chart(canvasHtml.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "粉丝数",
                        yAxisID: "followerCount",
                        data: data[0],
                        borderColor: 'rgba(255,99,132,1)',
                        borderWidth: 2,
                    }, {
                        label: "点赞数",
                        yAxisID: "likeCount",
                        data: data[1],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        followerCount: {
                            display: true,
                            title: {
                                display: IS_PC,
                                text: '粉',
                            },
                            type: 'linear',
                            position: 'left',
                            ticks: {
                                stepSize: data["confg.followerCount.step"],
                                maxTicksLimit: 11,
                            },
                            // beginAtZero: true
                        },
                        likeCount: {
                            display: true,
                            title: {
                                display: IS_PC,
                                text: '赞',

                            },
                            type: 'linear',
                            position: 'right',
                            ticks: {
                                stepSize: data["confg.likeCount.step"],
                                maxTicksLimit: 11,
                            }
                        }
                    },
                    layout: {
                        padding: {
                            left: IS_PC ? 50 : 0,
                            right: IS_PC ? 50 : 0,
                        }
                    },
                    responsive: true,
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true,
                        animationDuration: 0 // 悬停项目时动画的持续时间

                    },
                    animation: {
                        duration: 0 // 一般动画时间
                    },
                    responsiveAnimationDuration: 0 // 调整大小后的动画持续时间
                }

            });
        }

    </script>
    <style type="text/css">
        html {
            scroll-behavior: smooth;
        }
        /*隐藏滚动条*/
        ::-webkit-scrollbar {
            display: none; /* Chrome Safari */
        }
    </style>


</head>
<body style="word-wrap:break-word;  word-break:break-all; width: 95%;">
<div class="headerPage"></div>

<center>
    <img src="/res/image/edg.webp" width="100%">

    <a href="https://space.bilibili.com/31536760">
        <h1>EDG电子竞技俱乐部</h1>
    </a>
    <br>
    <div id="charts"></div>
    <div id="note">数据由淀粉倾情总结</div>
    <br>
    <br>

    <style type=\"text/css\">
        td {
            text-align: center;
            vertical-align: middle;
        }
    </style>

</center>
<div id="footerPage" class="footerPage" style="float:top; font-size:10px; padding:20px 0;">
    <center>
        <div class="copyright" style="width:300px;margin:0 auto;">
            Copyright
            <a href="https://dev.tencent.com/user?from=coding" style="color:black; cursor:text" target="__blank">
                &copy;
            </a>
            郝爸爸
        </div>
        <div>
            <img src="/mould/cop.png"> </img>
            <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802031788" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">京公网安备 11010802031788号</p></a>
            <br><a href="http://beian.gov.cn/portal/registerSystemInfo?recordcode=11010802031788">晋ICP备19002591号</a>
        </div>
    </center>

</div>
</body>
</html>